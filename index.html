<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valentine Chess</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #ffe0f0; /* soft pink background */
    font-family: sans-serif;
    user-select: none;
  }
  #chessboard {
    display: grid;
    grid-template-columns: repeat(8, 100px);
    grid-template-rows: repeat(8, 100px);
    border: 3px solid #ff4d88;
  }
  .square {
    width: 100px;
    height: 100px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 0;
    position: relative;
  }
  .white-square { background-color: #fff0f5; } /* pale pink */
  .pink-square { background-color: #ffb6c1; } /* pink */
  .piece {
    width: 80px;
    height: 80px;
    cursor: pointer;
    transition: transform 0.2s;
    z-index: 1;
  }
  .highlight {
    box-shadow: 0 0 10px 5px #ff4d88 inset;
  }
  #message {
    position: absolute;
    top: 20px;
    font-size: 24px;
    color: #ff1a75;
    font-weight: bold;
    text-align: center;
    width: 100%;
  }
  .heart {
    position: absolute;
    font-size: 30px;
    animation: pop 0.6s forwards;
    pointer-events: none;
  }
  @keyframes pop {
    0% { transform: scale(0.5); opacity: 1; }
    50% { transform: scale(1.3); opacity: 1; }
    100% { transform: scale(1); opacity: 0; }
  }
  .confetti {
    position: absolute;
    font-size: 24px;
    animation: fall 2s linear forwards;
  }
  @keyframes fall {
    0% { transform: translateY(0) rotate(0deg); }
    100% { transform: translateY(600px) rotate(360deg); opacity: 0; }
  }
</style>
</head>
<body>

<div id="message">Your move ðŸ’–</div>
<div id="chessboard"></div>

<script>
const board = document.getElementById("chessboard");
const message = document.getElementById("message");

// Board setup
const files = ['a','b','c','d','e','f','g','h'];
const ranks = [8,7,6,5,4,3,2,1];
let selectedPiece = null;
let gameOver = false;

// Piece images
const pieces = {
  'white': {
    'king':'white_king.png',
    'queen':'white_queen.png',
    'rook':'white_rook.png',
    'bishop':'white_bishop.png',
    'knight':'white_knight.png',
    'pawn':'white_pawn.png'
  },
  'black': {
    'king':'black_king.png',
    'queen':'black_queen.png',
    'rook':'black_rook.png',
    'bishop':'black_bishop.png',
    'knight':'black_knight.png',
    'pawn':'black_pawn.png'
  }
};

// Initial positions (simple FEN-style object)
let boardState = {};
function initBoardState() {
  boardState = {};
  // Pawns
  for (let f=0; f<8; f++) {
    boardState[files[f]+'2'] = {color:'white', type:'pawn'};
    boardState[files[f]+'7'] = {color:'black', type:'pawn'};
  }
  // Rooks
  boardState['a1'] = {color:'white', type:'rook'};
  boardState['h1'] = {color:'white', type:'rook'};
  boardState['a8'] = {color:'black', type:'rook'};
  boardState['h8'] = {color:'black', type:'rook'};
  // Knights
  boardState['b1'] = {color:'white', type:'knight'};
  boardState['g1'] = {color:'white', type:'knight'};
  boardState['b8'] = {color:'black', type:'knight'};
  boardState['g8'] = {color:'black', type:'knight'};
  // Bishops
  boardState['c1'] = {color:'white', type:'bishop'};
  boardState['f1'] = {color:'white', type:'bishop'};
  boardState['c8'] = {color:'black', type:'bishop'};
  boardState['f8'] = {color:'black', type:'bishop'};
  // Queens
  boardState['d1'] = {color:'white', type:'queen'};
  boardState['d8'] = {color:'black', type:'queen'};
  // Kings
  boardState['e1'] = {color:'white', type:'king'};
  boardState['e8'] = {color:'black', type:'king'};
}

initBoardState();

// Draw board
function drawBoard() {
  board.innerHTML = '';
  for(let r=0; r<8; r++){
    for(let f=0; f<8; f++){
      const square = document.createElement('div');
      square.classList.add('square');
      square.id = files[f]+ranks[r];
      if((f+r)%2===0) square.classList.add('white-square');
      else square.classList.add('pink-square');
      // Add piece if exists
      const pos = files[f]+ranks[r];
      if(boardState[pos]){
        const p = boardState[pos];
        const img = document.createElement('img');
        img.src = pieces[p.color][p.type];
        img.classList.add('piece');
        img.dataset.pos = pos;
        img.dataset.color = p.color;
        img.dataset.type = p.type;
        img.addEventListener('click', selectPiece);
        square.appendChild(img);
      }
      board.appendChild(square);
    }
  }
}

// Piece selection
function selectPiece(e){
  if(gameOver) return;
  const pos = e.target.dataset.pos;
  const piece = boardState[pos];
  if(piece.color !== 'white') return; // player is white
  if(selectedPiece){
    clearHighlights();
  }
  selectedPiece = {pos: pos, piece: piece};
  highlightMoves(pos, piece);
}

// Highlight possible moves (simplified: all empty squares + captures)
function highlightMoves(pos,piece){
  clearHighlights();
  const squares = Object.keys(boardState);
  for(const sq of squares){
    if(sq !== pos && boardState[sq].color !== piece.color){
      document.getElementById(sq).classList.add('highlight');
    }
  }
  // Also highlight empty squares (naive: any empty square)
  for(const f of files){
    for(const r of ranks){
      const sq = f+r;
      if(!boardState[sq]){
        document.getElementById(sq).classList.add('highlight');
      }
    }
  }
}

// Clear highlights
function clearHighlights(){
  const sqs = document.querySelectorAll('.square');
  sqs.forEach(sq => sq.classList.remove('highlight'));
}

// Move piece
board.addEventListener('click', (e)=>{
  if(!selectedPiece) return;
  const target = e.target.closest('.square');
  if(!target || !target.id) return;
  if(!target.classList.contains('highlight')) return;
  const from = selectedPiece.pos;
  const to = target.id;
  const captured = boardState[to];
  boardState[to] = selectedPiece.piece;
  delete boardState[from];
  drawBoard();
  selectedPiece = null;
  clearHighlights();
  // Heart on capture
  if(captured) showHeart(target);
  checkCheckmate();
  setTimeout(botMove, 500);
});

// Heart pop-up on capture
function showHeart(square){
  const heart = document.createElement('div');
  heart.classList.add('heart');
  heart.style.left = '35px';
  heart.style.top = '35px';
  heart.textContent = 'ðŸ’—';
  square.appendChild(heart);
  setTimeout(()=>heart.remove(), 600);
}

// Bot move (random legal move)
function botMove(){
  if(gameOver) return;
  const blackPieces = Object.keys(boardState).filter(k=>boardState[k].color==='black');
  if(blackPieces.length===0) return;
  const from = blackPieces[Math.floor(Math.random()*blackPieces.length)];
  const piece = boardState[from];
  // Naive random move: any empty square or capture
  let possible = [];
  for(const f of files){
    for(const r of ranks){
      const sq = f+r;
      if(!boardState[sq] || boardState[sq].color==='white') possible.push(sq);
    }
  }
  const to = possible[Math.floor(Math.random()*possible.length)];
  const captured = boardState[to];
  boardState[to] = piece;
  delete boardState[from];
  drawBoard();
  if(captured) showHeart(document.getElementById(to));
  checkCheckmate();
}

// Naive check/checkmate detection (simplified)
function checkCheckmate(){
  // If black king captured â†’ player wins
  let blackKingExists = false;
  for(const k in boardState){
    if(boardState[k].type==='king' && boardState[k].color==='black') blackKingExists = true;
  }
  if(!blackKingExists){
    gameOver = true;
    message.textContent = "You did it! Happy Valentineâ€™s Day ðŸ’Œ";
    showConfetti();
  }
}

// Heart confetti
function showConfetti(){
  for(let i=0;i<50;i++){
    const c = document.createElement('div');
    c.classList.add('confetti');
    c.style.left = Math.random()*700+'px';
    c.style.color = '#ff1a75';
    c.textContent = 'ðŸ’–';
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),2000);
  }
}

drawBoard();
</script>

</body>
</html>
